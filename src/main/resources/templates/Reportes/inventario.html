<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head><title>Reporte Inventario</title></head>
<body>
<div th:fragment="content" class="container mx-auto px-4 py-6">
    <h1 class="text-3xl font-bold mb-6"><i class="fas fa-boxes mr-2"></i>Reporte de Inventario</h1>

    <!-- Filtros -->
    <div class="bg-white rounded-xl shadow p-6 mb-6">
        <form th:action="@{/reporte/inventario}" method="get" class="grid md:grid-cols-4 gap-4">
            <div>
                <label class="block text-sm font-semibold mb-2">Categoría</label>
                <select name="categoriaId" class="w-full px-3 py-2 border rounded-lg">
                    <option value="">Todas</option>
                    <option th:each="cat : ${categorias}" th:value="${cat.idCategoria}"
                            th:text="${cat.nombre}" th:selected="${categoriaId == cat.idCategoria}">Cat</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-semibold mb-2">Estado</label>
                <select name="activo" class="w-full px-3 py-2 border rounded-lg">
                    <option value="">Todos</option>
                    <option value="true">Activos</option>
                    <option value="false">Inactivos</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-semibold mb-2">Stock Mínimo</label>
                <input type="number" name="stockMinimo" th:value="${stockMinimo}"
                       placeholder="Ej: 10" class="w-full px-3 py-2 border rounded-lg">
            </div>
            <div class="flex items-end">
                <button type="submit" class="w-full bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                    <i class="fas fa-search mr-2"></i>Filtrar
                </button>
            </div>
        </form>
    </div>

    <!-- Estadísticas -->
    <div class="grid md:grid-cols-4 gap-6 mb-6">
        <div class="bg-blue-500 rounded-xl shadow-lg p-6 text-white">
            <p class="text-sm">Total Productos</p>
            <p class="text-3xl font-bold" th:text="${totalProductos}">0</p>
        </div>
        <div class="bg-green-500 rounded-xl shadow-lg p-6 text-white">
            <p class="text-sm">Stock Total</p>
            <p class="text-3xl font-bold" th:text="${stockTotal}">0</p>
        </div>
        <div class="bg-yellow-500 rounded-xl shadow-lg p-6 text-white">
            <p class="text-sm">Valor Inventario</p>
            <p class="text-3xl font-bold" th:text="'$' + ${valorInventario}">$0</p>
        </div>
        <div class="bg-red-500 rounded-xl shadow-lg p-6 text-white">
            <p class="text-sm">Bajo Stock</p>
            <p class="text-3xl font-bold" th:text="${productosConBajoStock}">0</p>
        </div>
    </div>

    <!-- Exportar -->
    <div class="flex gap-4 mb-4">
        <a th:href="@{/reporte/inventario/excel(categoriaId=${categoriaId},activo=${activo})}"
           class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
            <i class="fas fa-file-excel mr-2"></i>Excel
        </a>
        <a th:href="@{/reporte/inventario/pdf(categoriaId=${categoriaId},activo=${activo})}"
           class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
            <i class="fas fa-file-pdf mr-2"></i>PDF
        </a>
    </div>

    <!-- Tabla -->
    <div class="bg-white rounded-xl shadow overflow-hidden">
        <table class="min-w-full">
            <thead class="bg-gray-800 text-white">
            <tr>
                <th class="px-4 py-3 text-left">Código Barra</th>
                <th class="px-4 py-3 text-left">Nombre</th>
                <th class="px-4 py-3 text-left">Categoría</th>
                <th class="px-4 py-3 text-center">Stock</th>
                <th class="px-4 py-3 text-right">Precio</th>
                <th class="px-4 py-3 text-right">Valor Total</th>
                <th class="px-4 py-3 text-center">Estado</th>
            </tr>
            </thead>
            <tbody class="divide-y">
            <tr th:each="p : ${productos}" class="hover:bg-gray-50">
                <td class="px-4 py-3" th:text="${p.codigoBarra != null ? p.codigoBarra : '-'}">-</td>
                <td class="px-4 py-3 font-semibold" th:text="${p.nombre}">-</td>
                <td class="px-4 py-3" th:text="${p.categoria != null ? p.categoria.nombre : '-'}">-</td>
                <td class="px-4 py-3 text-center">
                    <span th:text="${p.stock}"
                          th:classappend="${p.stock <= 10} ? 'bg-red-100 text-red-800 px-2 py-1 rounded' : ''">0</span>
                </td>
                <td class="px-4 py-3 text-right" th:text="'$' + ${#numbers.formatDecimal(p.precioVenta, 1, 2)}">$0</td>
                <td class="px-4 py-3 text-right font-semibold" th:text="'$' + ${#numbers.formatDecimal(p.precioVenta * p.stock, 1, 2)}">$0</td>
                <td class="px-4 py-3 text-center">
                    <span class="px-2 py-1 rounded text-sm"
                          th:classappend="${p.activo} ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'"
                          th:text="${p.activo ? 'Activo' : 'Inactivo'}">-</span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</body>
</html>
