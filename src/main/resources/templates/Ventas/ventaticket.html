<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Ticket de Venta #<span th:text="${venta.idVenta}">001</span></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
        }

        .ticket {
            max-width: 380px;
            margin: 20px auto;
            padding: 20px;
            border: 2px solid #e5e7eb;
        }

        @media print {
            body * {
                visibility: hidden;
            }

            .ticket,
            .ticket * {
                visibility: visible;
            }

            .ticket {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: none;
                margin: 0;
                padding: 15px;
            }

            .no-print {
                display: none !important;
            }

            .break-inside {
                break-inside: avoid;
            }
        }

        @page {
            size: 80mm auto;
            margin: 0;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="ticket bg-white rounded-lg shadow-lg">
        <!-- Header del ticket -->
        <div class="text-center border-b-2 border-dashed border-gray-300 pb-4 mb-4">
            <h2 class="text-xl font-bold text-gray-800 mb-2">SISTEMA DE VENTAS</h2>
            <p class="text-sm text-gray-600">RUT: 12.345.678-9</p>
            <p class="text-sm text-gray-600">Dirección: Calle Principal #123</p>
            <p class="text-sm text-gray-600">Teléfono: +56 9 1234 5678</p>
        </div>

        <!-- Información de la venta -->
        <div class="mb-4 break-inside">
            <div class="grid grid-cols-2 gap-2 text-sm">
                <div>
                    <span class="font-semibold">Ticket #:</span>
                    <span th:text="${venta.idVenta}">001</span>
                </div>
                <div class="text-right">
                    <span class="font-semibold">Fecha:</span>
                    <span th:text="${#temporals.format(venta.fechaVenta, 'dd/MM/yyyy')}">01/01/2024</span>
                </div>
                <div>
                    <span class="font-semibold">Hora:</span>
                    <span th:text="${#temporals.format(venta.fechaVenta, 'HH:mm:ss')}">10:30:00</span>
                </div>
                <div class="text-right">
                    <span class="font-semibold">Cajero:</span>
                    <span th:text="${venta.idUsuario}">001</span>
                </div>
            </div>
        </div>

        <!-- Información del cliente -->
        <div class="mb-4 break-inside">
            <div class="text-sm">
                <span class="font-semibold">Cliente: </span>
                <span th:if="${venta.idCliente != null}" th:text="'ID: ' + ${venta.idCliente}">Cliente registrado</span>
                <span th:unless="${venta.idCliente != null}" class="text-gray-600 italic">Venta genérica</span>
            </div>
        </div>

        <div class="border-b-2 border-dashed border-gray-300 mb-4"></div>

        <!-- Detalles de productos -->
        <div class="mb-4 break-inside">
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b border-gray-300">
                        <th class="text-left py-2">Cant.</th>
                        <th class="text-left py-2">Producto</th>
                        <th class="text-right py-2">Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- TODO: Aquí irían los detalles de la venta cuando implementes DetalleVenta -->
                    <tr class="border-b border-gray-200">
                        <td class="py-2">1</td>
                        <td class="py-2">
                            <div class="font-medium">Producto Ejemplo</div>
                            <div class="text-xs text-gray-600">$10.00 c/u</div>
                        </td>
                        <td class="text-right py-2 font-medium">$10.00</td>
                    </tr>
                    <!-- Más productos... -->
                </tbody>
            </table>
        </div>

        <div class="border-b-2 border-dashed border-gray-300 mb-4"></div>

        <!-- Totales -->
        <div class="mb-4 break-inside">
            <div class="flex justify-between items-center text-lg font-bold">
                <span>TOTAL:</span>
                <span class="text-2xl" th:text="'$' + ${#numbers.formatDecimal(venta.totalVenta, 1, 2)}">$0.00</span>
            </div>

            <div class="mt-2 text-sm">
                <div class="flex justify-between">
                    <span>Método de pago:</span>
                    <span th:text="${#strings.capitalize(#strings.replace(venta.metodoPago, '_', ' '))}">Efectivo</span>
                </div>
            </div>
        </div>

        <div class="border-b-2 border-dashed border-gray-300 mb-4"></div>

        <!-- Footer -->
        <div class="text-center text-sm text-gray-600 break-inside">
            <p class="mb-2">¡Gracias por su compra!</p>
            <p class="text-xs">Software desarrollado con Spring Boot</p>
            <p class="text-xs" th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm:ss')}">
                Impreso: 01/01/2024 10:30:00
            </p>
        </div>
    </div>

    <!-- Botones de acción (no se imprimen) -->
    <div class="text-center mt-6 no-print space-x-4">
        <button onclick="window.print();"
            class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold shadow-lg hover:bg-blue-700 transition-colors">
            <i class="fas fa-print mr-2"></i>Imprimir Ticket
        </button>

        <a th:href="@{/ventas}"
            class="bg-red-600 text-white px-6 py-3 rounded-lg font-semibold shadow-lg hover:bg-red-700 transition-colors inline-block">
            <i class="fas fa-cash-register mr-2"></i>Volver al POS
        </a>

        <a th:href="@{/ventas/historial}"
            class="bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold shadow-lg hover:bg-gray-700 transition-colors inline-block">
            <i class="fas fa-history mr-2"></i>Ver Historial
        </a>
    </div>

    <script>
        // Auto-imprimir si se especifica en la URL
        if (window.location.search.includes('autoprint=true')) {
            setTimeout(() => {
                window.print();
            }, 1000);
        }
    </script>
</body>

</html>